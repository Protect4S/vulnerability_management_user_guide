# Copy of satellite system database user

Database connections are not mandatory for most systems (apart for Java), but in order to get the most out of Protect4S VM, we recommend to create a database connection using the System connection wizard. For this connection you will need to create a database user in the database of the satellite system.

Also keep in mind that if you connect to a satellite data base type other then the one of the Protect4S system, you might need to install Database libraries for that Database. **See Appendix B: Installation database libraries**.

✔ If you choose not to create a database connection this implies that some specific database checks might fail with the error message “_Unable to process the check by a technical error_”.

✔ If the database connection is not available then in some cases a fallback mechanism is used to retrieve database specific information. For example for ABAP systems an RFC is used for MSSQL and MaxDB. For HANA a fallback is implemented via the OS command HDBCLI. This will only work if the SAPControl connection user is the \<sid>adm OS user and can access the hdbuserstore.

✔ For Java systems, Database connections are mandatory as many checks rely on this connection type.

In the System connection wizard, a database connection will be created. A user with **read-only** access (SELECT privilege) is required on the following tables (Depending if you have an **ABAP** or **JAVA** stack):

| <p><strong>All Database Types</strong><br><strong>ABAP Schema</strong></p>                                                                                                                                                                                                                                                                                                               | <p><strong>All Database Types</strong><br><strong>JAVA Schema</strong></p> | <p><strong>Additional tables</strong><br><strong>for MSSQL</strong></p>                           | <p><strong>Additional tables</strong><br><strong>for HANA</strong></p>                                                                                                                                                                                                 |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `DD09L, USRACL, SEC_POLICY_ATTR, SEC_POLICY_RT, EWOSS, SPTH, USR02 (no pw hashes read), TDDAT, RSAUPROF, VSCAN_PROF, AGR_USERS, SRT_CFG_CLI_ASGN, USR40, UST04, PRGN_CUST, SXPGCOSTAB, RFCDES, RFCCBWHITELIST, SXROUTE, TCCSEC, SSF_PSE_H, SSF_PSE_L, ADIRACCESS, TMSPVERS, /SSF/DHEAD, DEVACCESS, ICF_SESSION_CNTL, VSCAN_SERVER, TMSPCONF, UCONCOCKPIT, SLDW_HEADER, USOBAUTHINACTIVE` | `J2EE_CONFIGENTRY`                                                         | `sys.objects, sys.server_principals, sys.server_role_members, sys.sql_logins, sys.configurations` | `CATALOG READ, _SYS_REPO.DELIVERY_UNITS, _SYS_SECURITY.`_`_`_`SYS_PASSWORD_BLACKLIST, SYS.GRANTED_PRIVILEGES, SYS.GRANTED_ROLE, SYS.LCM_SOFTWARE_COMPONENTS, SYS.M_DATABASE_HISTORY, SYS.M_INIFILE_CONTENTS, SYS.M_LICENSE, SYS.M_PASSWORD_PASSWORD_POLICY, SYS.USERS` |

To create the database user you can use the standard database tooling or a SQL scripts. See some examples specifically for creating users for the **ABAP** stack below).



## Examples

Please notice the following in the examples below:

* the placeholders %user% and %password% should be replaced with your own username and password
* the placeholder %SAPSID% need to be replaced by the SAP Database schema. This depends on the Database used, for Oracle this is typically SAPR3 or SAPSR3 and for MaxDB this is typically SAP%SID% (ABAP) or SAP%SID%DB (JAVA) where %SID% is the SAP System-ID.

## MaxDB: <a href="#maxdb" id="maxdb"></a>

```
CREATE USER %user% PASSWORD %password% STANDARD ENABLE CONNECT //
GRANT SELECT ON %SAPSID%.USR40 TO %user% // 
GRANT SELECT ON %SAPSID%.PRGN_CUST TO %user% // 
GRANT SELECT ON %SAPSID%.UST04 TO %user% // 
GRANT SELECT ON %SAPSID%.SXPGCOSTAB TO %user% // 
GRANT SELECT ON %SAPSID%.RFCDES TO %user% // 
GRANT SELECT ON %SAPSID%.RFCCBWHITELIST TO %user% // 
GRANT SELECT ON %SAPSID%.SXROUTE TO %user% // 
GRANT SELECT ON %SAPSID%.TCCSEC TO %user% // 
GRANT SELECT ON %SAPSID%.SSF_PSE_H TO %user% // 
GRANT SELECT ON %SAPSID%.SSF_PSE_L TO %user% // 
GRANT SELECT ON %SAPSID%.ADIRACCESS TO %user% // 
GRANT SELECT ON %SAPSID%.TMSPVERS TO %user% // 
GRANT SELECT ON %SAPSID%./SSF/DHEAD TO %user% // 
GRANT SELECT ON %SAPSID%.ICF_SESSION_CNTL TO %user% // 
GRANT SELECT ON %SAPSID%.DEVACCESS TO %user% // 
GRANT SELECT ON %SAPSID%.VSCAN_SERVER TO %user% // 
GRANT SELECT ON %SAPSID%.TMSPCONF TO %user% //
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user% //
GRANT SELECT ON %SAPSID%.SRT_CFG_CLI_ASGN TO %user% //
GRANT SELECT ON %SAPSID%.DD09L TO %user% //
GRANT SELECT ON %SAPSID%.USRACL TO %user% //
GRANT SELECT ON %SAPSID%.SEC_POLICY_ATTR TO %user% //
GRANT SELECT ON %SAPSID%.SEC_POLICY_RT TO %user% //
GRANT SELECT ON %SAPSID%.EWOSS TO %user% //
GRANT SELECT ON %SAPSID%.SPTH TO %user% //
GRANT SELECT ON %SAPSID%.USR02 TO %user% //
GRANT SELECT ON %SAPSID%.TDDAT TO %user% //
GRANT SELECT ON %SAPSID%.RSAUPROF TO %user% //
GRANT SELECT ON %SAPSID%.VSCAN_PROF TO %user% //
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user% //
```

## ORACLE / DB2 / Sybase (till 15.70): <a href="#oracle-db2-sybase" id="oracle-db2-sybase"></a>

For Sybase releases higher than 15.70 see [here](satellite\_system\_database\_user-1.md#sybase-version-16.0-onwards).

```
CREATE USER %user% IDENTIFIED BY %password%;
GRANT CONNECT TO %user%;
GRANT SELECT ON %SAPSID%.USR40 TO %user%;
GRANT SELECT ON %SAPSID%.PRGN_CUST TO %user%;
GRANT SELECT ON %SAPSID%.UST04 TO %user%;
GRANT SELECT ON %SAPSID%.SXPGCOSTAB TO %user%;
GRANT SELECT ON %SAPSID%.ICFSERVLOC TO %user%;
GRANT SELECT ON %SAPSID%.RFCDES TO %user%;
GRANT SELECT ON %SAPSID%.RFCCBWHITELIST TO %user%;
GRANT SELECT ON %SAPSID%.SXROUTE TO %user%;
GRANT SELECT ON %SAPSID%.TCCSEC TO %user%;
GRANT SELECT ON %SAPSID%.SSF_PSE_H TO %user%;
GRANT SELECT ON %SAPSID%.SSF_PSE_L TO %user%;
GRANT SELECT ON %SAPSID%.ADIRACCESS TO %user%;
GRANT SELECT ON %SAPSID%.TMSPVERS TO %user%;
GRANT SELECT ON %SAPSID%./SSF/DHEAD TO %user%;
GRANT SELECT ON %SAPSID%.ICF_SESSION_CNTL TO %user%;
GRANT SELECT ON %SAPSID%.DEVACCESS TO %user%;
GRANT SELECT ON %SAPSID%.VSCAN_SERVER TO %user%;
GRANT SELECT ON %SAPSID%.TMSPCONF TO %user%;
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user%;
GRANT SELECT ON %SAPSID%.SRT_CFG_CLI_ASGN TO %user%;
GRANT SELECT ON %SAPSID%.DD09L TO %user%;
GRANT SELECT ON %SAPSID%.USRACL TO %user%;
GRANT SELECT ON %SAPSID%.SEC_POLICY_ATTR TO %user%;
GRANT SELECT ON %SAPSID%.SEC_POLICY_RT TO %user%;
GRANT SELECT ON %SAPSID%.EWOSS TO %user%;
GRANT SELECT ON %SAPSID%.SPTH TO %user%;
GRANT SELECT ON %SAPSID%.USR02 TO %user%;
GRANT SELECT ON %SAPSID%.TDDAT TO %user%;
GRANT SELECT ON %SAPSID%.RSAUPROF TO %user%;
GRANT SELECT ON %SAPSID%.VSCAN_PROF TO %user%;
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user%;

/*** For DB2 ONLY:
GRANT SELECT ON SYSCAT.SCHEMATA TO %user%;
```

_(Sybase is also known as Adaptive Server Enterprise (ASE))_

#### **Sybase version 15.70 and 16.0 onwards**&#x20;

There are some changes in version 16.0 one of them has the impact on the support of legacy query statements. In fact, these changes were introduced since 15.7 but previous statements could still be executed prior version 16.\
If your Sybase database version is 16 or higher it is possible that you can no longer execute the legacy query statements. The affected part is namely the part to create a user.

Create users with (sapsa or sa, is by default not allowed, use a different user either sapsso / sap\_sso or an equivalent user).

```
isql -S<SID> -U<user> -P<Password> -X
use <SID>
go
sp_addlogin <newUser>,<Password>
go
sp_adduser <newUser>
go
```

Granting the permissions to tables cannot by executed by sapsso / sap\_sso. Use sapsa / sa or an equivalent user in terms of permission. The query for the granting permission is the same as prior versions. The same query can be used to grant mentioned [here](satellite\_system\_database\_user-1.md#oracle-db2-sybase).

Note: If you cannot grant select permission to the table \<SchemaName_>_./SSF/DHEAD using quotes due to syntax error, make sure the following database property is switched on: quoted\_identifier on

Reference:\
[2219100 - How to set option quoted\_identifier for user tables, system tables and sp\_help](https://launchpad.support.sap.com/#/notes/2219100)

## HANA as part of ABAP or Java: <a href="#hana" id="hana"></a>

```
/*** RUN AS SYSTEM OWNER:
CREATE USER %user% PASSWORD %PASSWORD%; (Create the user with password)
ALTER USER %user% DISABLE PASSWORD LIFETIME; (Disable PW change on logon)
GRANT RESTRICTED_USER_ODBC_ACCESS TO %user%; (Provide grant for ODBC access)
GRANT CATALOG READ TO %user%;
GRANT SELECT ON _SYS_REPO.DELIVERY_UNITS TO %user%;
GRANT SELECT ON _SYS_SECURITY._SYS_PASSWORD_BLACKLIST TO %user%;

GRANT SELECT ON SYS.GRANTED_PRIVILEGES TO %user%;
GRANT SELECT ON SYS.GRANTED_ROLES TO %user%;
GRANT SELECT ON SYS.LCM_SOFTWARE_COMPONENTS TO %user%;
GRANT SELECT ON SYS.M_DATABASE_HISTORY TO %user%;
GRANT SELECT ON SYS.M_INIFILE_CONTENTS TO %user%;
GRANT SELECT ON SYS.M_LICENSE TO %user%;
GRANT SELECT ON SYS.M_PASSWORD_POLICY TO %user%;
GRANT SELECT ON SYS.USERS TO %user%;


/*** RUN AS SCHEMA OWNER OR SYSTEM OWNER:
GRANT SELECT ON %SAPSID%.USR40 TO %user%; (Provide grants for individual tables, SELECT only)
GRANT SELECT ON %SAPSID%.PRGN_CUST TO %user%;
GRANT SELECT ON %SAPSID%.UST04 TO %user%;
GRANT SELECT ON %SAPSID%.SXPGCOSTAB TO %user%;
GRANT SELECT ON %SAPSID%.ICFSERVLOC TO %user%;
GRANT SELECT ON %SAPSID%.RFCDES TO %user%;
GRANT SELECT ON %SAPSID%.RFCCBWHITELIST TO %user%;
GRANT SELECT ON %SAPSID%.SXROUTE TO %user%;
GRANT SELECT ON %SAPSID%.TCCSEC TO %user%;
GRANT SELECT ON %SAPSID%.SSF_PSE_H TO %user%;
GRANT SELECT ON %SAPSID%.SSF_PSE_L TO %user%;
GRANT SELECT ON %SAPSID%.ADIRACCESS TO %user%;
GRANT SELECT ON %SAPSID%.TMSPVERS TO %user%;
GRANT SELECT ON %SAPSID%."/SSF/DHEAD" TO %user%;
GRANT SELECT ON %SAPSID%.ICF_SESSION_CNTL TO %user%;
GRANT SELECT ON %SAPSID%.DEVACCESS TO %user%;
GRANT SELECT ON %SAPSID%.VSCAN_SERVER TO %user%;
GRANT SELECT ON %SAPSID%.TMSPCONF TO %user%;
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user%;
GRANT SELECT ON %SAPSID%.SRT_CFG_CLI_ASGN TO %user%;
GRANT SELECT ON %SAPSID%.DD09L TO %user%;
GRANT SELECT ON %SAPSID%.USRACL TO %user%;
GRANT SELECT ON %SAPSID%.SEC_POLICY_ATTR TO %user%;
GRANT SELECT ON %SAPSID%.SEC_POLICY_RT TO %user%;
GRANT SELECT ON %SAPSID%.EWOSS TO %user%;
GRANT SELECT ON %SAPSID%.SPTH TO %user%;
GRANT SELECT ON %SAPSID%.USR02 TO %user%;
GRANT SELECT ON %SAPSID%.TDDAT TO %user%;
GRANT SELECT ON %SAPSID%.RSAUPROF TO %user%;
GRANT SELECT ON %SAPSID%.VSCAN_PROF TO %user%;
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user%;
```

## HANA standalone: <a href="#hana" id="hana"></a>

```
/*** RUN AS SYSTEM OWNER:
CREATE USER %user% PASSWORD %PASSWORD%; (Create the user with password)
ALTER USER %user% DISABLE PASSWORD LIFETIME; (Disable PW change on logon)
GRANT RESTRICTED_USER_ODBC_ACCESS TO %user%; (Provide grant for ODBC access)
GRANT SELECT ON _SYS_SECURITY._SYS_PASSWORD_BLACKLIST TO %user%;
GRANT SELECT ON _SYS_REPO.DELIVERY_UNITS TO %user%;
GRANT SELECT ON SYS.LCM_SOFTWARE_COMPONENTS TO %user%;
GRANT SELECT ON SYS.M_INIFILE_CONTENTS TO %user%;
GRANT SELECT ON SYS.GRANTED_PRIVILEGES TO %user%;
GRANT SELECT ON SYS.M_PASSWORD_POLICY TO %user%;
GRANT SELECT ON SYS.GRANTED_ROLES TO %user%;
GRANT SELECT ON SYS.M_DATABASE_HISTORY TO %user%;
GRANT SELECT ON SYS.USERS TO %user%;
GRANT SELECT ON SYS.M_LICENSE TO %user%;
GRANT CATALOG READ TO %user%;
```

## MSSQL (support as of MSSQL 2012) <a href="#hana" id="hana"></a>

```
Run from MSSQL while logged on as <SID>adm:

USE <DBSID>
GO
CREATE LOGIN %user% WITH PASSWORD='%password%', DEFAULT_DATABASE=<DBSID>
GO
CREATE USER %user% FOR LOGIN %user% 
GO
ALTER USER %user% WITH DEFAULT_SCHEMA=<SAPSID>
GO
GRANT CONNECT TO %user%
GO
GRANT SELECT ON %SAPSID%.USR40 TO %user%
GRANT SELECT ON %SAPSID%.PRGN_CUST TO %user%
GRANT SELECT ON %SAPSID%.UST04 TO %user%
GRANT SELECT ON %SAPSID%.SXPGCOSTAB TO %user%
GRANT SELECT ON %SAPSID%.ICFSERVLOC TO %user%
GRANT SELECT ON %SAPSID%.RFCDES TO %user%
GRANT SELECT ON %SAPSID%.RFCCBWHITELIST TO %user%
GRANT SELECT ON %SAPSID%.SXROUTE TO %user%
GRANT SELECT ON %SAPSID%.TCCSEC TO %user%
GRANT SELECT ON %SAPSID%.SSF_PSE_H TO %user% 
GRANT SELECT ON %SAPSID%.SSF_PSE_L TO %user%
GRANT SELECT ON %SAPSID%.ADIRACCESS TO %user% 
GRANT SELECT ON %SAPSID%.TMSPVERS TO %user%
GRANT SELECT ON "%SAPSID%./SSF/DHEAD" TO %user% 
GRANT SELECT ON %SAPSID%.ICF_SESSION_CNTL TO %user% 
GRANT SELECT ON %SAPSID%.DEVACCESS TO %user%
GRANT SELECT ON %SAPSID%.VSCAN_SERVER TO %user% 
GRANT SELECT ON %SAPSID%.TMSPCONF TO %user%
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user%
GRANT SELECT ON %SAPSID%.SRT_CFG_CLI_ASGN TO %user%
GRANT SELECT ON %SAPSID%.DD09L TO %user%
GRANT SELECT ON %SAPSID%.USRACL TO %user%
GRANT SELECT ON %SAPSID%.SEC_POLICY_ATTR TO %user%
GRANT SELECT ON %SAPSID%.SEC_POLICY_RT TO %user%
GRANT SELECT ON %SAPSID%.EWOSS TO %user%
GRANT SELECT ON %SAPSID%.SPTH TO %user%
GRANT SELECT ON %SAPSID%.USR02 TO %user%
GRANT SELECT ON %SAPSID%.TDDAT TO %user%
GRANT SELECT ON %SAPSID%.RSAUPROF TO %user%
GRANT SELECT ON %SAPSID%.VSCAN_PROF TO %user%
GRANT SELECT ON %SAPSID%.AGR_USERS TO %user%
USE master
GO
GRANT CONTROL SERVER TO %user%;
GO
```

In case of problems with the database user, please check Appendix A: [Database connection](../appendix\_a\_troubleshooting\_satellite\_system\_connec/database\_connection.md).
